<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">module.exports = {

<span id='global-method-generateXml'>  /**
</span>   * @method generateXml
   * Generate the XML for the winsw configuration file.
   * @param {Object} config
   * The config object must have the following attributes:
   *
   * - *id* This is is how the service is identified. Alphanumeric, no spaces.
   * - *name* The descriptive name of the service.
   * - *script* The absolute path of the node.js script. i.e. `C:\path\to\myService.js`
   *
   * Optional attributes include
   *
   * - *description* The description that shows up in the service manager.
   * - *flags* Any flags that should be passed to node. Defaults to `--harmony` to add ES6 support.
   * - *logmode* Valid values include `rotate` (default), `reset` (clear log), `roll` (move to .old), and `append`.
   * - *logpath* The absolute path to the directory where logs should be stored. Defaults to the current directory.
   * - *dependencies* A comma delimited list or array of process dependencies.
   * - *env* A key/value object or array of key/value objects containing
   * environment variables to pass to the process. The object might look like `{name:'HOME',value:'c:\Windows'}`.
   */
  generateXml: function(config){

    // Set default values
    config = config || {};
    config.description = config.description || '';
    config.flags = config.flags || '--harmony';
    config.logmode = 'rotate';

    // Initial template
    var xml = '&lt;service&gt;&lt;id&gt;'
            +config.id
            +'&lt;/id&gt;&lt;name&gt;'
            +config.name
            +'&lt;/name&gt;&lt;description&gt;'
            +config.description
            +'&lt;/description&gt;&lt;executable&gt;node.exe&lt;/executable&gt;&lt;arguments&gt;'
            +config.flags
            +' '+config.script
            +'&lt;/arguments&gt;&lt;logmode&gt;'
            +config.logmode
            +'&lt;/logmode&gt;';

    // Optionally add log path
    if (config.logpath) {
      xml += '&lt;logpath&gt;'+config.logpath+'&lt;/logpath&gt;';
    }

    // Optionally add service dependencies
    if (config.dependencies){
      config.dependencies = (config.dependencies instanceof Array == true) ? config.dependencies : config.dependencies.split(',');
      config.dependencies.forEach(function(dep){
        xml += '&lt;depend&gt;'+dep.trim()+'&lt;/depend&gt;';
      });
    }

    // Optionally add environment values
    if (config.env){
      config.env = (config.env instanceof Array == true) ? config.env : [config.env];
      config.env.forEach(function(env){
        xml += '&lt;env name=&quot;'+env.name+'&quot; value=&quot;'+env.value+'&quot; /&gt;';
      });
    }

    xml += &quot;&lt;/service&gt;&quot;;

    return xml;
  },

<span id='global-method-createExe'>  /**
</span>   * @method createExe
   * Create the executable
   * @param {String} name
   * The alphanumeric string (spaces are stripped) of the `.exe` file. For example, `My App` generates `myapp.exe`
   * @param {String} [dir=cwd]
   * The output directory where the executable will be saved.
   * @param {Function} [callback]
   * The callback to fire upon completion.
   */
  createExe: function(name,dir,callback){
    var fs = require('fs'), p = require('path');

    if (typeof dir === 'function'){
      callback = dir;
      dir = null;
    }

    dir = dir || process.cwd();

    var origin = p.join(__dirname,'..','bin','winsw','x'+(require('os').arch().indexOf('64')&gt;0 ? '64':'86'),'winsw.exe'),
        dest = p.join(dir,name.replace(/[^\w]/gi,'').toLowerCase()+'.exe'),
        data = fs.readFileSync(origin,{encoding:'binary'});

    fs.writeFileSync(dest,data,{encoding:'binary'});
    callback &amp;&amp; callback();
    //require('child_process').exec('Icacls &quot;'+dest+'&quot; /grant Everyone:(F)',callback)
    //require('child_process').exec('copy &quot;'+origin+'&quot; /y /v /b &quot;'+dest+'&quot; /b',callback);
  }

}
</pre>
</body>
</html>
